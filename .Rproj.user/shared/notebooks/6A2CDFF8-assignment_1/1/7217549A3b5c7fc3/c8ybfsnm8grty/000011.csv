"0","# ---- 4.1: MOE analysis for demographic variables ----"
"0",""
"0","# Safety: ensure tract_demo exists"
"0","stopifnot(exists(""tract_demo""))"
"0",""
"0","tract_moe <- tract_demo %>%"
"0","  dplyr::mutate("
"0","    # MOE% for each group (only when estimate > 0 and MOE available)"
"0","    white_moe_pct    = dplyr::if_else(!is.na(white_nhE)  & white_nhE  > 0 & !is.na(white_nhM),"
"0","                                      100 * white_nhM  / white_nhE,  NA_real_),"
"0","    black_moe_pct    = dplyr::if_else(!is.na(black_nhE)  & black_nhE  > 0 & !is.na(black_nhM),"
"0","                                      100 * black_nhM  / black_nhE,  NA_real_),"
"0","    hispanic_moe_pct = dplyr::if_else(!is.na(hispanicE)  & hispanicE  > 0 & !is.na(hispanicM),"
"0","                                      100 * hispanicM  / hispanicE,  NA_real_),"
"0",""
"0","    # Per-group >15% flags"
"0","    over15_white = white_moe_pct    > 15,"
"0","    over15_black = black_moe_pct    > 15,"
"0","    over15_hisp  = hispanic_moe_pct > 15,"
"0",""
"0","    # Any group over threshold"
"0","    high_moe_flag = over15_white | over15_black | over15_hisp"
"0","  )"
"0",""
"0","# Overall summary"
"0","tract_moe_summary <- tract_moe %>%"
"0","  dplyr::summarise("
"0","    total_tracts    = dplyr::n(),"
"0","    high_moe_tracts = sum(high_moe_flag, na.rm = TRUE),"
"0","    pct_high_moe    = round(100 * high_moe_tracts / total_tracts, 1),"
"0","    # count tracts where at least one MOE% couldn't be computed"
"0","    any_moe_na      = sum(is.na(white_moe_pct) | is.na(black_moe_pct) | is.na(hispanic_moe_pct))"
"0","  )"
"0",""
"0","knitr::kable("
"0","  tract_moe_summary,"
"0","  digits = 1,"
"0","  caption = ""Summary of high-MOE tracts (ACS 2018â€“2022 5-year)"""
"0",")"
