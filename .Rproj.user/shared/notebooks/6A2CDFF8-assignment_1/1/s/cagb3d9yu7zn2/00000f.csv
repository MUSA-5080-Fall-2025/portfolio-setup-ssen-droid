"0","# ---- Decision framework table (minimal + robust) ----"
"0","library(dplyr)"
"0","library(knitr)"
"0",""
"0","decision_tbl <- county_reliability %>%"
"0","  # keep rows where we can actually decide something"
"0","  filter(!is.na(med_incomeE), !is.na(income_moe_pct)) %>%"
"0","  # If your data already has `reliability`, we’ll use it; otherwise derive it from MOE%"
"0","  mutate("
"0","    reliability = case_when("
"0","      !is.na(reliability) ~ reliability,"
"0","      income_moe_pct <= 5     ~ ""High Confidence"","
"0","      income_moe_pct <= 10    ~ ""Moderate Confidence"","
"0","      TRUE                    ~ ""Low Confidence"""
"0","    ),"
"0","    # Map reliability -> implementation recommendation"
"0","    recommendation = case_when("
"0","      reliability == ""High Confidence""      ~ ""Safe for algorithmic decisions"","
"0","      reliability == ""Moderate Confidence""  ~ ""Use with caution - monitor outcomes"","
"0","      reliability == ""Low Confidence""       ~ ""Requires manual review or additional data"","
"0","      TRUE                                  ~ ""Review needed"""
"0","    ),"
"0","    # Pretty formatting for display only"
"0","    `Median income ($)` = formatC(med_incomeE, format = ""f"", digits = 0, big.mark = "",""),"
"0","    `Income MOE %` = sprintf(""%.1f%%"", income_moe_pct),"
"0","    # Order rows by reliability (High → Moderate → Low)"
"0","    reliability = factor(reliability, levels = c(""High Confidence"",""Moderate Confidence"",""Low Confidence""))"
"0","  ) %>%"
"0","  transmute("
"0","    County = county,"
"0","    `Median income ($)`,"
"0","    `Income MOE %`,"
"0","    Reliability = reliability,"
"0","    Recommendation = recommendation"
"0","  ) %>%"
"0","  arrange(Reliability, County)"
"0",""
"0","knitr::kable("
"0","  decision_tbl,"
"0","  caption = ""Decision Framework for Algorithm Implementation (ACS 2022 5-year)"""
"0",")"
